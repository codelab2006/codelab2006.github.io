<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><title> Web Components 实例教程 - 黄永健的个人站点 </title><link rel="stylesheet" href="/assets/css/icons.css"/><link rel="stylesheet" href="/assets/css/normalize.css"/><link rel="stylesheet" href="/assets/css/styles.css"/></head><body class="d-flex flex-direction-column"><header class="p-relative"><div class="d-flex h-4 px-8px bg-primary text-light align-items-center justify-content-space-between"><div class="font-size-2em">网络日志</div><button id="nav-toggler" class="icon-nav-toggler"></button></div><div id="nav-container" class="bg-primary px-8px align-items-center"><nav><ul class="d-flex"><li class="mx-16px my-16px"><a class="text-light" href="/">首页</a></li><li class="mx-16px my-16px"><a class="text-light" href="/blog">网络日志</a></li><li class="mx-16px my-16px"><a class="text-light" href="/codelab">Codelab</a></li><li class="mx-16px my-16px"><a class="text-light" href="/about.html">关于作者</a></li></ul></nav></div></header><main class="flex-grow-1"><div class="d-flex justify-content-center my-48px px-8px"><article class="container"><h1 class="p-6px bb-1px"> Web Components 实例教程 </h1><div class="my-16px"><span class="d-block p-6px">作者：黄永健</span><span class="d-block p-6px">日期：2020-03-01</span></div><div class="my-32px p-6px content"><h2 id="一-概念">一. 概念</h2><p>Web Components 是一套允许你创建可重用的自定义元素的技术，它由浏览器直接提供，不需要引入任何第三方框架。Web Components 由三部分组成：</p><ul><li><strong>自定义元素（Custom elements）</strong> 一套 JavaScript API，用来定义自定义元素和行为。</li><li><strong>影子 DOM（Shadow DOM）</strong> 一套 JavaScript API，用来封装影子 DOM 树，并将其添加到元素上。</li><li><strong>HTML 模板（HTML templates）</strong> 使用 &lt;template&gt; 和 &lt;slot&gt; 元素编写不在呈现页面中显示的标记模板。然后它们可以作为自定义元素结构的基础被多次重用。</li></ul><h2 id="二-举个例子">二. 举个例子</h2><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
      <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello, web components<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;popup-message</span> <span class="na">data-message=</span><span class="s">"Hello web components"</span><span class="nt">&gt;&lt;/popup-message&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">class</span> <span class="nx">PopupMessage</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
        <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">super</span><span class="p">();</span>

          <span class="kd">const</span> <span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">open</span><span class="dl">"</span> <span class="p">});</span>
          <span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createContainer</span><span class="p">();</span>
          <span class="kd">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createIcon</span><span class="p">();</span>
          <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createMessage</span><span class="p">();</span>

          <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">icon</span><span class="p">);</span>
          <span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

          <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">style</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">style</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span>
            <span class="dl">"</span><span class="s2">.container { box-sizing: border-box; display: flex; border: 1px solid black; width: 300px; height: 100px; padding: 10px; align-items: center; }</span><span class="dl">"</span> <span class="o">+</span>
            <span class="dl">"</span><span class="s2">.icon { width: 64px; height: 64px; background-color: lime; }</span><span class="dl">"</span> <span class="o">+</span>
            <span class="dl">"</span><span class="s2">.message { flex-grow: 1; text-align: center; }</span><span class="dl">"</span><span class="p">;</span>

          <span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
          <span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">createContainer</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">container</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">container</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">createIcon</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">icon</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">icon</span><span class="dl">"</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">icon</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">createMessage</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">span</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">message</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">message</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-message</span><span class="dl">"</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">message</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="dl">"</span><span class="s2">popup-message</span><span class="dl">"</span><span class="p">,</span> <span class="nx">PopupMessage</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p>从上面的例子可以看到，我们创建了一个自定义元素 popup-message，并在 html 文档中使用这个新的元素。你可以在<a href="/assets/examples/Web-Components/popup-message.html">这里</a>查看实际的运行结果。</p><h2 id="三-自定义元素custom-elements">三. 自定义元素（Custom elements）</h2><p>Web Components 的一个核心功能是创建自定义的元素。我们可以将功能封装到自定义元素中，并重用它们。在使用自定义元素之前我们需要定义和注册它。我们需要创建一个新的类来定义自定义元素，正如上面例子中的 PopupMessage 类。除此之外我们使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define">CustomElementRegistry.define()</a> 方法注册我们的自定义元素。注册之后我们便可以在 html 文档中使用它。</p><p>我们也可以为自定义元素添加生命周期回调函数，这些回调函数将在元素生命周期的特定时刻被触发，请看下面的例子。</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
      <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello, web components<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"operation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"add"</span><span class="nt">&gt;</span>添加自定义元素<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"update"</span><span class="nt">&gt;</span>更新自定义元素<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"remove"</span><span class="nt">&gt;</span>移除自定义元素<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"console"</span><span class="nt">&gt;&lt;/ul&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">custom-element</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">static</span> <span class="kd">get</span> <span class="nx">observedAttributes</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="dl">"</span><span class="s2">attribute-aaa</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">attribute-bbb</span><span class="dl">"</span><span class="p">];</span>
          <span class="p">}</span>

          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Create CustomElement</span><span class="dl">"</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">open</span><span class="dl">"</span> <span class="p">});</span>
            <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">div</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">class</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">box</span><span class="dl">"</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">style</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">style</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span>
              <span class="dl">"</span><span class="s2">.box { height: 100px; background-color: red; border: 2px solid black; margin: 2px; }</span><span class="dl">"</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">connectedCallback</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; connectedCallback called</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">disconnectedCallback</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; disconnectedCallback called</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">adoptedCallback</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; adoptedCallback called</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="nx">attributeChangedCallback</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">(</span>
              <span class="s2">`&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; attributeChangedCallback called name: </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">, oldValue: </span><span class="p">${</span><span class="nx">oldValue</span><span class="p">}</span><span class="s2">, newValue: </span><span class="p">${</span><span class="nx">newValue</span><span class="p">}</span><span class="s2">`</span>
            <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
      <span class="kd">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#console</span><span class="dl">"</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
      <span class="p">};</span>

      <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">operationEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#operation</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">addEl</span> <span class="o">=</span> <span class="nx">operationEl</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#add</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">updateEl</span> <span class="o">=</span> <span class="nx">operationEl</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#update</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">updateEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">removeEl</span> <span class="o">=</span> <span class="nx">operationEl</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#remove</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">removeEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="kd">let</span> <span class="nx">customElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">containerEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#container</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">addEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">customElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">custom-element</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">CustomElement created</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Before customElement setAttribute attribute-aaa</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">customElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">attribute-aaa</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">AAA</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">After customElement setAttribute attribute-aaa</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Before customElement setAttribute attribute-bbb</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">customElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">attribute-bbb</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">BBB</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">After customElement setAttribute attribute-bbb</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">containerEl</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">customElement</span><span class="p">);</span>
          <span class="nx">addEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">updateEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="nx">removeEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">updateEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">customElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">attribute-aaa</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">AAAChange</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">customElement</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">attribute-bbb</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">BBBChange</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">removeEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">containerEl</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">customElement</span><span class="p">);</span>
          <span class="nx">addEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">updateEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="nx">removeEl</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p>你可以在<a href="/assets/examples/Web-Components/custom-elements-lifecycle-callbacks.html">这里</a>查看实际的运行结果。</p><h2 id="四-影子-domshadow-dom">四. 影子 DOM（Shadow DOM）</h2><p>Web Components 的另一个重要的功能是封装，而影子 DOM 就是实现封装的基础。使用 Element.attachShadow 方法可以在当前元素上创建一个影子 DOM。影子 DOM 通过限制你对其子节点的访问来实现封装。请分析下面的例子：</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
      <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello, web components<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;span&gt;</span>请查看控制台...<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;tree-node-no-shadow&gt;&lt;/tree-node-no-shadow&gt;</span>
    <span class="nt">&lt;tree-node-open&gt;&lt;/tree-node-open&gt;</span>
    <span class="nt">&lt;tree-node-closed&gt;&lt;/tree-node-closed&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">tree-node-no-shadow</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">noShadowId</span><span class="dl">"</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`document.querySelector("#noShadowId"): </span><span class="p">${</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">#noShadowId</span><span class="dl">"</span>
        <span class="p">)}</span><span class="s2">`</span>
      <span class="p">);</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">tree-node-open</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">open</span><span class="dl">"</span> <span class="p">});</span>
            <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">openId</span><span class="dl">"</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`document.querySelector("#openId"): </span><span class="p">${</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">#openId</span><span class="dl">"</span>
        <span class="p">)}</span><span class="s2">`</span>
      <span class="p">);</span>
      <span class="kd">const</span> <span class="nx">treeNodeOpen</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">tree-node-open</span><span class="dl">"</span><span class="p">).</span><span class="nx">shadowRoot</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`document.querySelector("tree-node-open").shadowRoot: </span><span class="p">${</span><span class="nx">treeNodeOpen</span><span class="p">}</span><span class="s2">`</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`treeNodeOpen.querySelector("#openId"): </span><span class="p">${</span><span class="nx">treeNodeOpen</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">#openId</span><span class="dl">"</span>
        <span class="p">)}</span><span class="s2">`</span>
      <span class="p">);</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">tree-node-closed</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">closed</span><span class="dl">"</span> <span class="p">});</span>
            <span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">div</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">closedId</span><span class="dl">"</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`document.querySelector("#closedId"): </span><span class="p">${</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">#closedId</span><span class="dl">"</span>
        <span class="p">)}</span><span class="s2">`</span>
      <span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
        <span class="s2">`document.querySelector("tree-node-closed").shadowRoot: </span><span class="p">${</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">tree-node-closed</span><span class="dl">"</span><span class="p">).</span><span class="nx">shadowRoot</span>
        <span class="p">}</span><span class="s2">`</span>
      <span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p>我们创建了三个自定义元素：</p><ul><li><strong>tree-node-no-shadow</strong> 未使用影子 DOM，其 noShadowId 子节点可以使用 document.querySelector(“#noShadowId”) 找到。</li><li><strong>tree-node-open</strong> 使用了 mode 为 open 的影子 DOM，其 openId 子节点不能使用 document.querySelector(“#openId”) 找到。但是我们可以先找到自定义元素 tree-node-open，再从其 shadowRoot 开始，使用 querySelector(“#openId”) 查找。</li><li><strong>tree-node-closed</strong> 使用了 mode 为 closed 的影子 DOM，其 closedId 子节点不能使用 document.querySelector(“#closedId”) 找到。甚至想引用其 shadowRoot 都是不可能的。</li></ul><p>你可以在<a href="/assets/examples/Web-Components/shadow-dom.html">这里</a>查看实际的运行结果。</p><h2 id="五-html-模板html-templates">五. HTML 模板（HTML templates）</h2><h3 id="template">template</h3><p>从上面的例子我们可以看到，我们常常使用 document.createElement(“…”) 方法创建元素，并设置其属性。实际上我们可以在 template 元素中定义它们。</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
      <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello, web components<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"popup-message-tpl"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;style&gt;</span>
        <span class="nc">.container</span> <span class="p">{</span>
          <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
          <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
          <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span>
          <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
          <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
          <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.icon</span> <span class="p">{</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
          <span class="nl">height</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
          <span class="nl">background-color</span><span class="p">:</span> <span class="no">lime</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.message</span> <span class="p">{</span>
          <span class="nl">flex-grow</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
          <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="nt">&lt;/style&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"icon"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"message"</span><span class="nt">&gt;&lt;/span&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;popup-message</span>
      <span class="na">data-message=</span><span class="s">"Hello web components message 1"</span>
    <span class="nt">&gt;&lt;/popup-message&gt;</span>
    <span class="nt">&lt;popup-message</span>
      <span class="na">data-message=</span><span class="s">"Hello web components message 2"</span>
    <span class="nt">&gt;&lt;/popup-message&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">popup-message</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">popup-message-tpl</span><span class="dl">"</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">shadowRoot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">closed</span><span class="dl">"</span> <span class="p">});</span>
            <span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
            <span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
              <span class="dl">"</span><span class="s2">.message</span><span class="dl">"</span>
            <span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">data-message</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p>你可以在<a href="/assets/examples/Web-Components/html-templates-template.html">这里</a>查看实际的运行结果。</p><h3 id="slot">slot</h3><p>上一个例子中，我们看到可以通过传入不同的 data-message 显示不同的信息。如果我们希望显示更复杂的内容，我们就需要使用 slot。</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
      <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Hello, web components<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"popup-message-tpl"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;style&gt;</span>
        <span class="nc">.container</span> <span class="p">{</span>
          <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
          <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
          <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span>
          <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
          <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
          <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.icon</span> <span class="p">{</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
          <span class="nl">height</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
          <span class="nl">background-color</span><span class="p">:</span> <span class="no">lime</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.message</span> <span class="p">{</span>
          <span class="nl">flex-grow</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
          <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="nt">&lt;/style&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"icon"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"message"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;slot</span> <span class="na">name=</span><span class="s">"message"</span><span class="nt">&gt;</span>default message<span class="nt">&lt;/slot&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;popup-message&gt;&lt;/popup-message&gt;</span>
    <span class="nt">&lt;popup-message&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">slot=</span><span class="s">"message"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
          <span class="nt">&lt;li&gt;</span>Message 1<span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span>Message 2<span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/popup-message&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">popup-message</span><span class="dl">"</span><span class="p">,</span>
        <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
          <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">popup-message-tpl</span><span class="dl">"</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">shadowRoot</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">closed</span><span class="dl">"</span> <span class="p">});</span>
            <span class="nx">shadowRoot</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p>你可以在<a href="/assets/examples/Web-Components/html-templates-slot.html">这里</a>查看实际的运行结果。</p></div></article></div></main><footer class="min-h-16 px-8px bg-primary p-relative"><div id="footer-panel" class="bg-primary px-8px"></div></footer><script src="/assets/js/script.js"></script></body></html>